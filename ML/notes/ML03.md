# èµ„æ–™

- https://tianchi.aliyun.com/notebook-ai/detail?spm=5176.20222472.J_3678908510.6.275467c2PlUzzf&postId=170914



# ç¬”è®°

## 0. æµç¨‹æ€»è§ˆ

- Step1: åº“å‡½æ•°å¯¼å…¥
- Step2: æ•°æ®è¯»å–/è½½å…¥
- Step3: æ•°æ®ä¿¡æ¯ç®€å•æŸ¥çœ‹
- Step4: å¯è§†åŒ–æè¿°
- Step5: åˆ©ç”¨ LightGBM è¿›è¡Œè®­ç»ƒä¸é¢„æµ‹
- Step6: åˆ©ç”¨ LightGBM è¿›è¡Œç‰¹å¾é€‰æ‹©
- Step7: é€šè¿‡è°ƒæ•´å‚æ•°è·å¾—æ›´å¥½çš„æ•ˆæœ



## 1. å¯¼å…¥å‡½æ•°åº“

```python
##  åŸºç¡€å‡½æ•°åº“
import numpy as np 
import pandas as pd

## ç»˜å›¾å‡½æ•°åº“
import matplotlib.pyplot as plt
import seaborn as sns
```



## 2. æ•°æ®è¯»å–/è½½å…¥

```python
df = pd.read_csv('./high_diamond_ranked_10min.csv')
y = df.blueWins
```



## 3. æ•°æ®ä¿¡æ¯ç®€å•æŸ¥çœ‹

- info
- headã€tail
- value_counts
- describe

```python
# dfæ•´ä½“ä¿¡æ¯
df.info()
# å¤´orå°¾è¡Œ
df.head()
df.tail()
# ç»Ÿè®¡ä¿¡æ¯
df.describe()
```

```python
# æ ‡æ³¨ç‰¹å¾åˆ—å’Œæ ‡ç­¾åˆ—
drop_cols = ['gameId', 'blueWins']
x = df.drop(drop_cols, axis=1)
y = df.blueWins
```

```python
# æŸ¥çœ‹æ ‡ç­¾æ•°é‡ï¼ˆæ˜¯å¦å‡è¡¡ï¼‰
y.value_counts()
```

```python
# å»é™¤å†—ä½™æ•°æ®(ç”±å…¶ä»–åˆ—é€šè¿‡ç®€å•è¿ç®—å¯å¾—å‡ºçš„åˆ—)
drop_cols = ['redFirstBlood','redKills','redDeaths','redGoldDiff','redExperienceDiff','blueCSPerMin','blueGoldPerMin','redCSPerMin','redGoldPerMin']
x.drop(drop_cols, axis=1, inplace=True)
```



## 4. å¯è§†åŒ–æè¿°

### çŸ¥è¯†ç‚¹

- å°æç´å›¾: `sns.violinplot()`ã€‚ç”¨æ¥å±•ç¤ºå¤šç»„æ•°æ®çš„åˆ†å¸ƒçŠ¶æ€ä»¥åŠæ¦‚ç‡å¯†åº¦
- çƒ­åŠ›å›¾ï¼š`sns.heatmap()`ã€‚å±•ç¤ºç‰¹å¾çš„ç›¸å…³æ€§
- æ•£ç‚¹å›¾ï¼š`sns.swarmplot`ã€‚ä¸çƒ­åŠ›å›¾ç±»ä¼¼ï¼Œæ•°æ®ç‚¹ç›´æ¥æ˜¾ç¤ºåœ¨å›¾ä¸Šï¼ˆè€Œä¸æ˜¯æ¦‚ç‡å¯†åº¦ï¼‰
- å¹³å‡å€¼ï¼šdf.mean()
- æ ‡å‡†å·®ï¼šdf.std()
- æŠ½æ ·ï¼šdf.sample()
- Melt: pd.melt()ã€‚å°†dfå®½æ•°æ®å˜æˆé•¿æ•°æ®ã€‚ç”¨ä¾‹è§æ•£ç‚¹å›¾
- Concat: pd.concat()ã€‚æ‹¼åˆä¸¤dfå½¢æˆæ–°df
- pd.hist()ã€‚é¢‘æ•°ç›´æ–¹å›¾
- æ ‡å‡†åˆ†æ•°(Standard Score) = ï¼ˆæ•°æ® - å¹³å‡å€¼ï¼‰/ æ ‡å‡†å·®ï¼Œè¡¨ç¤ºæ•°æ®åœ¨ä¸€ç»„æ•°å€¼å†…çš„ç›¸å¯¹ä½ç½®
- Sis.pairplot()ã€‚åˆ†æç‰¹å¾ä¸¤ä¸¤ç»„åˆåï¼Œç»“æœçš„åŒºåˆ†åº¦

### åˆ†æè¿‡ç¨‹

1. æ•´ä½“æŸ¥çœ‹

```python
data = x
data_std = (data - data.mean()) / data.std()
# å°†ç‰¹å¾åˆ‡åˆ†æˆä¸¤éƒ¨åˆ†æ–¹ä¾¿æ˜¾ç¤º
data = pd.concat([y, data_std.iloc[:, 0:9]], axis=1)
data = pd.melt(data, id_vars='blueWins', var_name='Features', value_name='Values')

# åˆ†æˆä¸¤å¼ å­å›¾
fig, ax = plt.subplots(1,2,figsize=(15,5))

# ç»˜åˆ¶å°æç´å›¾ï¼ˆ0ï½9ç‰¹å¾ï¼‰
sns.violinplot(x='Features', y='Values', hue='blueWins', data=data, split=True,
               inner='quart', ax=ax[0], palette='Blues')
fig.autofmt_xdate(rotation=45)


# ç»§ç»­plotç¬¬äºŒéƒ¨åˆ†
data = x
data_std = (data - data.mean()) / data.std()
data = pd.concat([y, data_std.iloc[:, 9:18]], axis=1)
data = pd.melt(data, id_vars='blueWins', var_name='Features', value_name='Values')

# ç»˜åˆ¶å°æç´å›¾
sns.violinplot(x='Features', y='Values', hue='blueWins', 
               data=data, split=True, inner='quart', ax=ax[1], palette='Blues')
fig.autofmt_xdate(rotation=45)

plt.show()
```

ä»å°æç´å›¾å¤§è‡´å¯ä»¥å¾—å‡ºç»“è®ºï¼š

- å‡»æ€è‹±é›„æ•°é‡è¶Šå¤šæ›´å®¹æ˜“èµ¢ï¼Œæ­»äº¡æ•°é‡è¶Šå¤šè¶Šå®¹æ˜“è¾“ï¼ˆbluekillsä¸bluedeathså·¦å³çš„åŒºåˆ«ï¼‰ã€‚
- åŠ©æ”»æ•°é‡ä¸å‡»æ€è‹±é›„æ•°é‡å½¢æˆçš„å›¾å½¢çŠ¶ç±»ä¼¼ï¼Œè¯´æ˜ä»–ä»¬å¯¹æ¸¸æˆç»“æœçš„å½±å“å·®ä¸å¤šã€‚
- ä¸€è¡€çš„å–å¾—æƒ…å†µä¸è·èƒœæœ‰æ­£ç›¸å…³ï¼Œä½†æ˜¯ç›¸å…³æ€§ä¸å¦‚å‡»æ€è‹±é›„æ•°é‡æ˜æ˜¾ã€‚
- ç»æµå·®ä¸ç»éªŒå·®å¯¹äºæ¸¸æˆèƒœè´Ÿçš„å½±å“è¾ƒå¤§ã€‚
- å‡»æ€é‡æ€ªæ•°é‡å¯¹æ¸¸æˆèƒœè´Ÿçš„å½±å“å¹¶ä¸å¤§ã€‚



2. æ¸…ç†æ‰ä½æ•ˆç‰¹å¾

- ç›¸å…³åº¦é«˜çš„

```python
# é€šè¿‡çƒ­åŠ›å›¾å±•ç¤ºç‰¹å¾ç›¸å…³æ€§
plt.figure(figsize=(18,14))
sns.heatmap(round(x.corr(),2), cmap='Blues', annot=True)
plt.show()

# å»é™¤å†—ä½™ï¼ˆç›¸å…³æ€§é«˜ï¼‰çš„ç‰¹å¾
drop_cols = ['redAvgLevel','blueAvgLevel']
x.drop(drop_cols, axis=1, inplace=True)
```



- é’ˆå¯¹ï¼šæ’çœ¼æ•°ã€‚åˆ†ææ’çœ¼æ•°å·®å¯¹èƒœè´Ÿçš„å½±å“

```python
sns.set(style='whitegrid', palette='muted')

# æ„é€ ä¸¤ä¸ªæ–°ç‰¹å¾ï¼šæ’çœ¼å·®ï¼Œæ‹”çœ¼å·®
x['wardsPlacedDiff'] = x['blueWardsPlaced'] - x['redWardsPlaced']
x['wardsDestroyedDiff'] = x['blueWardsDestroyed'] - x['redWardsDestroyed']

# å–1000ä¸ªæ ·æœ¬ï¼Œå±•ç¤ºåœ¨æ•£ç‚¹å›¾ä¸Š
data = x[['blueWardsPlaces', 'blueWardsDestroyed', 'wardsPlacedDiff', 'wardsDestroyedDiff']].sample(1000)
data_std = (data - data.mean()) / data.std()
data = pd.concat([y, data_std], axis=1)
data = pd.melt(data, id_vars='blueWins', var_name="Features", value_name='Values')

plt.figure(figsize=(10,6))
sns.swarmplot(x='Features', y='Values', hue='blueWins', data=data)
plt.xticks(rotation=45)
plt.show()
```

çœ‹å‡ºæ“¦çœ¼æ•°ä¸èƒœè´Ÿæ²¡æœ‰æ˜¾è‘—è§„å¾‹ï¼Œå»é™¤è¿™äº›ç‰¹å¾

```python
drop_cols = ['blueWardsPlaced','blueWardsDestroyed','wardsPlacedDiff',
            'wardsDestroyedDiff','redWardsPlaced','redWardsDestroyed']
x.drop(drop_cols, axis=1, inplace=True)
```



- é’ˆå¯¹ï¼šå‡»æ€ã€è¾…åŠ©å‡»æ€

```python
# å‡€å‡»æ€
x['killsDiff'] = x['blueKills'] - x['blueDeaths']
# åŠ©æ”»å·®
x['assistsDiff'] = x['blueAssists'] - x['redAssists']

# ç›´æ–¹å›¾
x[['blueKills','blueDeaths','blueAssists','killsDiff','assistsDiff','redAssists']].hist(figsize=(12,10), bins=20)
plt.show()
```

å¯çœ‹å‡ºï¼Œå‡»æ€ã€æ­»äº¡ã€åŠ©æ”»æ•°çš„åˆ†å¸ƒå·®åˆ«ä¸å¤§

ä½†æ˜¯ï¼Œå‡€å‡»æ€å’ŒåŠ©æ”»å·®ä¸åŸåˆ†å¸ƒå·®åˆ«å¾ˆå¤§ =ã€‹ æ„é€ è¿™ä¸¤ä¸ªæ–°ç‰¹å¾

```python
# æ•£ç‚¹å›¾éªŒè¯ä¸€ä¸‹
data = x[['blueKills','blueDeaths','blueAssists','killsDiff','assistsDiff','redAssists']].sample(1000)

data_std = (data - data.mean()) / data.std()
data = pd.concat([y, data_std], axis=1)
data = pd.melt(data, id_vars='blueWins', var_name='Features', value_name='Values')

plt.figure(figsize=(10,6))
sns.swarmplot(x='Features', y='Values', hue='blueWins', data=data)
plt.xticks(rotation=45)
plt.show()
```

å¯çœ‹å‡ºï¼Œå‡»æ€æ•°ã€æ­»äº¡æ•°ã€åŠ©æ”»æ•°å’Œæ–°æ„é€ çš„ä¸¤ä¸ªdifféƒ½æœ‰è¾ƒå¥½çš„åŒºåˆ†åº¦

å†æ£€æŸ¥ä¸€ä¸‹pairplotï¼Œçœ‹èƒ½ä¸èƒ½å‘ç°æ–°çš„åŒºåˆ†åº¦é«˜çš„ç‰¹å¾ç»„åˆ

```python
data = pd.concat([y, x], axis=1).sample(500)

sns.pairplot(data, vars=['blueKills','blueDeaths','blueAssists','killsDiff','assistsDiff','redAssists'], 
             hue='blueWins')
plt.show()
```



- é’ˆå¯¹ï¼šé¾™å’Œç²¾è‹±æ€ª

```python
x['dragonsDiff'] = x['blueDragons'] - x['redDragons']
x['heraldsDiff'] = x['blueHeralds'] - x['redHeralds']
x['eliteDiff'] = x['blueEliteMonsters'] - x['redEliteMonsters']

data = pd.concat([y, x], axis=1)

eliteGroup = data.groupby(['eliteDiff'])['blueWins'].mean()
dragonGroup = data.groupby(['dragonsDiff'])['blueWins'].mean()
heraldGroup = data.groupby(['heraldsDiff'])['blueWins'].mean()

fig, ax = plt.subplots(1,3, figsize=(15,4))

eliteGroup.plot(kind='bar', ax=ax[0])
dragonGroup.plot(kind='bar', ax=ax[1])
heraldGroup.plot(kind='bar', ax=ax[2])

print(eliteGroup)
print(dragonGroup)
print(heraldGroup)

plt.show()
```

å‘ç°è¿™3ä¸ªéƒ½æ˜¯å¼ºç›¸å…³



- é’ˆå¯¹ï¼šå¡”

```python
x['towerDiff'] = x['blueTowersDestroyed'] - x['redTowersDestroyed']

data = pd.concat([y, x], axis=1)

towerGroup = data.groupby(['towerDiff'])['blueWins']
print(towerGroup.count())
print(towerGroup.mean())

fig, ax = plt.subplots(1,2,figsize=(15,5))

towerGroup.mean().plot(kind='line', ax=ax[0])
ax[0].set_title('Proportion of Blue Wins')
ax[0].set_ylabel('Proportion')

towerGroup.count().plot(kind='line', ax=ax[1])
ax[1].set_title('Count of Towers Destroyed')
ax[1].set_ylabel('Count')
```

*è¿™é‡Œä½¿ç”¨äº†blueWinsçš„å¹³å‡å€¼ä½œä¸ºè·èƒœæ¦‚ç‡

å‘ç°ï¼šå¤§éƒ¨åˆ†æƒ…å†µæ¨å¡”æ•°é‡éƒ½ç›¸å·®æ— å‡ ï¼Œä½†æ¨å¡”å·®å’Œèƒœåˆ©æ¦‚ç‡å…³ç³»æ˜æ˜¾



## 5. æ¨¡å‹è®­ç»ƒä¸é¢„æµ‹

åˆ©ç”¨LightGBM

### åˆ’åˆ†æ•°æ®é›†

```python
## ä¸ºäº†æ­£ç¡®è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œå°†æ•°æ®åˆ’åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå¹¶åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹ï¼Œåœ¨æµ‹è¯•é›†ä¸ŠéªŒè¯æ¨¡å‹æ€§èƒ½ã€‚
from sklearn.model_selection import train_test_split

## é€‰æ‹©å…¶ç±»åˆ«ä¸º0å’Œ1çš„æ ·æœ¬ ï¼ˆä¸åŒ…æ‹¬ç±»åˆ«ä¸º2çš„æ ·æœ¬ï¼‰
data_target_part = y
data_features_part = x

## æµ‹è¯•é›†å¤§å°ä¸º20%ï¼Œ 80%/20%åˆ†
x_train, x_test, y_train, y_test = train_test_split(data_features_part, data_target_part, test_size = 0.2, random_state = 2020)
```

### å¯¼å…¥æ¨¡å‹

```python
## å¯¼å…¥LightGBMæ¨¡å‹
from lightgbm.sklearn import LGBMClassifier
## å®šä¹‰ LightGBM æ¨¡å‹ 
clf = LGBMClassifier()
# åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒLightGBMæ¨¡å‹
clf.fit(x_train, y_train)
```

### é¢„æµ‹ï¼Œæ ¡éªŒï¼Œå¯è§†åŒ–ç»“æœ

```python
## åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šåˆ†å¸ƒåˆ©ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹
train_predict = clf.predict(x_train)
test_predict = clf.predict(x_test)
from sklearn import metrics

## åˆ©ç”¨accuracyï¼ˆå‡†ç¡®åº¦ï¼‰ã€é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ•°ç›®å æ€»é¢„æµ‹æ ·æœ¬æ•°ç›®çš„æ¯”ä¾‹ã€‘è¯„ä¼°æ¨¡å‹æ•ˆæœ
print('The accuracy of the Logistic Regression is:',metrics.accuracy_score(y_train,train_predict))
print('The accuracy of the Logistic Regression is:',metrics.accuracy_score(y_test,test_predict))

## æŸ¥çœ‹æ··æ·†çŸ©é˜µ (é¢„æµ‹å€¼å’ŒçœŸå®å€¼çš„å„ç±»æƒ…å†µç»Ÿè®¡çŸ©é˜µ)
confusion_matrix_result = metrics.confusion_matrix(test_predict,y_test)
print('The confusion matrix result:\n',confusion_matrix_result)

# åˆ©ç”¨çƒ­åŠ›å›¾å¯¹äºç»“æœè¿›è¡Œå¯è§†åŒ–
plt.figure(figsize=(8, 6))
sns.heatmap(confusion_matrix_result, annot=True, cmap='Blues')
plt.xlabel('Predicted labels')
plt.ylabel('True labels')
plt.show()
```



## 6. ç‰¹å¾é€‰æ‹©

### çŸ¥è¯†ç‚¹

- LightGBMçš„ç‰¹å¾é€‰æ‹©å±äºç‰¹å¾é€‰æ‹©ä¸­çš„åµŒå…¥å¼æ–¹æ³•ï¼Œåœ¨LightGBMä¸­å¯ä»¥ç”¨å±æ€§feature_importances_å»æŸ¥çœ‹ç‰¹å¾çš„é‡è¦åº¦ã€‚
- LightGBMè¯„ä¼°ç‰¹å¾é‡è¦ç¨‹åº¦æŒ‡æ ‡
  - clf.feature_importances_ï¼šLightGBMæ¨¡å‹çš„ç‰¹å¾é‡è¦åº¦
  - gainï¼šåŸºå°¼æŒ‡æ•°
  - splitï¼šç‰¹å¾è¢«ç”¨åˆ°çš„æ¬¡æ•°
- Sns.barplot

## åˆ†æè¿‡ç¨‹

```python
sns.barplot(y=data_features_part.columns, x=clf.feature_importances_)
```

å¯çœ‹å‡ºï¼Œç»æµå·®è·ï¼ŒåŠ©æ”»æ•°é‡ï¼Œå‡»æ€æ­»äº¡ç­‰ç‰¹å¾éƒ½æ¯”è¾ƒé‡è¦ã€‚

```python
from sklearn.metrics import accuracy_score
from lightgbm import plot_importance

def estimate(model,data):
    #sns.barplot(data.columns,model.feature_importances_)
    ax1=plot_importance(model,importance_type="gain")
    ax1.set_title('gain')
    ax2=plot_importance(model, importance_type="split")
    ax2.set_title('split')
    plt.show()
def classes(data,label,test):
    model=LGBMClassifier()
    model.fit(data,label)
    ans=model.predict(test)
    estimate(model, data)
    return ans
 
ans=classes(x_train,y_train,x_test)
pre=accuracy_score(y_test, ans)
print('acc=',accuracy_score(y_test,ans))
```



## 7. è°ƒå‚

### çŸ¥è¯†ç‚¹

- sklearn.model_selection import GridSearchCVï¼šç½‘æ ¼è°ƒå‚
- Sklearn.metrics.acuracy_score(y_true, predict_y): æ¨¡å‹å‡†ç¡®åº¦
- ...metrics.confusion_matrix(test_predict, y_test)ï¼šæ··æ·†çŸ©é˜µ
- sns.heatmap()ï¼šçƒ­åŠ›å›¾ã€‚ç”¨äºå¯è§†åŒ–æ··æ·†çŸ©é˜µ

### è¿‡ç¨‹

```python
## ä»sklearnåº“ä¸­å¯¼å…¥ç½‘æ ¼è°ƒå‚å‡½æ•°
from sklearn.model_selection import GridSearchCV

## å®šä¹‰å‚æ•°å–å€¼èŒƒå›´
learning_rate = [0.1, 0.3, 0.6]
feature_fraction = [0.5, 0.8, 1]
num_leaves = [16, 32, 64]
max_depth = [-1,3,5,8]

parameters = { 'learning_rate': learning_rate,
              'feature_fraction':feature_fraction,
              'num_leaves': num_leaves,
              'max_depth': max_depth}
model = LGBMClassifier(n_estimators = 50)

## è¿›è¡Œç½‘æ ¼æœç´¢
clf = GridSearchCV(model, parameters, cv=3, scoring='accuracy',verbose=3, n_jobs=-1)
clf = clf.fit(x_train, y_train)
```

```python
## ç½‘æ ¼æœç´¢åçš„æœ€å¥½å‚æ•°ä¸º
clf.best_params_
```

ç”¨æ–°å‚æ•°å†æ¬¡è®­ç»ƒæ¨¡å‹

```python
clf = LGBMClassifier(feature_fraction=0.8,
                     learning_rate=0.1, max_depth=-1, num_leaves=4)
clf.fit(x_train, y_train)

train_predict = clf.predict(x_train)
test_predict = clf.predict(x_test)

## åˆ©ç”¨accuracyï¼ˆå‡†ç¡®åº¦ï¼‰ã€é¢„æµ‹æ­£ç¡®çš„æ ·æœ¬æ•°ç›®å æ€»é¢„æµ‹æ ·æœ¬æ•°ç›®çš„æ¯”ä¾‹ã€‘è¯„ä¼°æ¨¡å‹æ•ˆæœ
print('The accuracy of the Logistic Regression is:',metrics.accuracy_score(y_train,train_predict))
print('The accuracy of the Logistic Regression is:',metrics.accuracy_score(y_test,test_predict))

confusion_matrix_result = metrics.confusion_matrix(test_predict, y_test)
print('Confusion matrix result: \n', confusion_matrix_result)

plt.figure(figsize=(8,6))
sns.heatmap(confusion_matrix_result, annot=True, fmt='.20g', cmap='Blues')
plt.xlabel('Predicted labels')
plt.ylabel('True labels')
plt.show()
```

å¯¹æ¯”è°ƒå‚å‰æ¨¡å‹æœ‰æ˜¾è‘—æå‡



# LightGBMç²—ç•¥åŸç†

LightGBMåº•å±‚å®ç°äº†GBDTç®—æ³•ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€ç³»åˆ—çš„æ–°ç‰¹æ€§ï¼š

1. åŸºäºç›´æ–¹å›¾ç®—æ³•è¿›è¡Œä¼˜åŒ–ï¼Œä½¿æ•°æ®å­˜å‚¨æ›´åŠ æ–¹ä¾¿ã€è¿ç®—æ›´å¿«ã€é²æ£’æ€§å¼ºã€æ¨¡å‹æ›´åŠ ç¨³å®šç­‰ã€‚
2. æå‡ºäº†å¸¦æ·±åº¦é™åˆ¶çš„ Leaf-wise ç®—æ³•ï¼ŒæŠ›å¼ƒäº†å¤§å¤šæ•°GBDTå·¥å…·ä½¿ç”¨çš„æŒ‰å±‚ç”Ÿé•¿ (level-wise) çš„å†³ç­–æ ‘ç”Ÿé•¿ç­–ç•¥ï¼Œè€Œä½¿ç”¨äº†å¸¦æœ‰æ·±åº¦é™åˆ¶çš„æŒ‰å¶å­ç”Ÿé•¿ç­–ç•¥ï¼Œå¯ä»¥é™ä½è¯¯å·®ï¼Œå¾—åˆ°æ›´å¥½çš„ç²¾åº¦ã€‚
3. æå‡ºäº†å•è¾¹æ¢¯åº¦é‡‡æ ·ç®—æ³•ï¼Œæ’é™¤å¤§éƒ¨åˆ†å°æ¢¯åº¦çš„æ ·æœ¬ï¼Œä»…ç”¨å‰©ä¸‹çš„æ ·æœ¬è®¡ç®—ä¿¡æ¯å¢ç›Šï¼Œå®ƒæ˜¯ä¸€ç§åœ¨å‡å°‘æ•°æ®é‡å’Œä¿è¯ç²¾åº¦ä¸Šå¹³è¡¡çš„ç®—æ³•ã€‚
4. æå‡ºäº†äº’æ–¥ç‰¹å¾æ†ç»‘ç®—æ³•ï¼Œé«˜ç»´åº¦çš„æ•°æ®å¾€å¾€æ˜¯ç¨€ç–çš„ï¼Œè¿™ç§ç¨€ç–æ€§å¯å‘æˆ‘ä»¬è®¾è®¡ä¸€ç§æ— æŸçš„æ–¹æ³•æ¥å‡å°‘ç‰¹å¾çš„ç»´åº¦ã€‚é€šå¸¸è¢«æ†ç»‘çš„ç‰¹å¾éƒ½æ˜¯äº’æ–¥çš„ï¼ˆå³ç‰¹å¾ä¸ä¼šåŒæ—¶ä¸ºéé›¶å€¼ï¼Œåƒone-hotï¼‰ï¼Œè¿™æ ·ä¸¤ä¸ªç‰¹å¾æ†ç»‘èµ·æ¥å°±ä¸ä¼šä¸¢å¤±ä¿¡æ¯ã€‚

LightGBMæ˜¯åŸºäºCARTæ ‘çš„é›†æˆæ¨¡å‹ï¼Œå®ƒçš„æ€æƒ³æ˜¯ä¸²è”å¤šä¸ªå†³ç­–æ ‘æ¨¡å‹å…±åŒè¿›è¡Œå†³ç­–ã€‚

![image.png](data:image/png;base64,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)

é‚£ä¹ˆå¦‚ä½•ä¸²è”å‘¢ï¼ŸLightGBMé‡‡ç”¨è¿­ä»£é¢„æµ‹è¯¯å·®çš„æ–¹æ³•ä¸²è”ã€‚ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç°åœ¨éœ€è¦é¢„æµ‹ä¸€è¾†è½¦ä»·å€¼3000å…ƒã€‚æˆ‘ä»¬æ„å»ºå†³ç­–æ ‘1è®­ç»ƒåé¢„æµ‹ä¸º2600å…ƒï¼Œæˆ‘ä»¬å‘ç°æœ‰400å…ƒçš„è¯¯å·®ï¼Œé‚£ä¹ˆå†³ç­–æ ‘2çš„è®­ç»ƒç›®æ ‡ä¸º400å…ƒï¼Œä½†å†³ç­–æ ‘2çš„é¢„æµ‹ç»“æœä¸º350å…ƒï¼Œè¿˜å­˜åœ¨50å…ƒçš„è¯¯å·®å°±äº¤ç»™ç¬¬ä¸‰æ£µæ ‘â€¦â€¦ä»¥æ­¤ç±»æ¨ï¼Œæ¯ä¸€é¢—æ ‘ç”¨æ¥ä¼°è®¡ä¹‹å‰æ‰€æœ‰æ ‘çš„è¯¯å·®ï¼Œæœ€åæ‰€æœ‰æ ‘é¢„æµ‹ç»“æœçš„æ±‚å’Œå°±æ˜¯æœ€ç»ˆé¢„æµ‹ç»“æœï¼

LightGBMçš„åŸºæ¨¡å‹æ˜¯CARTå›å½’æ ‘ï¼Œå®ƒæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼šï¼ˆ1ï¼‰CARTæ ‘ï¼Œæ˜¯ä¸€é¢—äºŒå‰æ ‘ã€‚ï¼ˆ2ï¼‰å›å½’æ ‘ï¼Œæœ€åæ‹Ÿåˆç»“æœæ˜¯è¿ç»­å€¼ã€‚

LightGBMæ¨¡å‹å¯ä»¥è¡¨ç¤ºä¸ºä»¥ä¸‹å½¢å¼ï¼Œæˆ‘ä»¬çº¦å®šğ‘“ğ‘¡(ğ‘¥)ft(x)è¡¨ç¤ºå‰ğ‘¡té¢—æ ‘çš„å’Œï¼Œâ„ğ‘¡(ğ‘¥)ht(x)è¡¨ç¤ºç¬¬ğ‘¡té¢—å†³ç­–æ ‘ï¼Œæ¨¡å‹å®šä¹‰å¦‚ä¸‹ï¼š

ğ‘“ğ‘¡(ğ‘¥)=âˆ‘ğ‘‡ğ‘¡=1â„ğ‘¡(ğ‘¥)ft(x)=âˆ‘t=1Tht(x)

ç”±äºæ¨¡å‹é€’å½’ç”Ÿæˆï¼Œç¬¬ğ‘¡tæ­¥çš„æ¨¡å‹ç”±ç¬¬ğ‘¡âˆ’1tâˆ’1æ­¥çš„æ¨¡å‹å½¢æˆï¼Œå¯ä»¥å†™æˆï¼š

ğ‘“ğ‘¡(ğ‘¥)=ğ‘“ğ‘¡âˆ’1(ğ‘¥)+â„ğ‘¡(ğ‘¥)ft(x)=ftâˆ’1(x)+ht(x)

æ¯æ¬¡éœ€è¦åŠ ä¸Šçš„æ ‘â„ğ‘¡(ğ‘¥)ht(x)æ˜¯ä¹‹å‰æ ‘æ±‚å’Œçš„è¯¯å·®ï¼š

ğ‘Ÿğ‘¡,ğ‘–=ğ‘¦ğ‘–âˆ’ğ‘“ğ‘šâˆ’1(ğ‘¥ğ‘–)rt,i=yiâˆ’fmâˆ’1(xi)

æˆ‘ä»¬æ¯ä¸€æ­¥åªè¦æ‹Ÿåˆä¸€é¢—è¾“å‡ºä¸ºğ‘Ÿğ‘¡,ğ‘–rt,içš„CARTæ ‘åŠ åˆ°ğ‘“ğ‘¡âˆ’1(ğ‘¥)ftâˆ’1(x)å°±å¯ä»¥äº†ã€‚





